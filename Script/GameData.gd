extends Node

const clicked_sound := preload("res://audio/clicked.wav")
const buy_EXP_sound := preload("res://audio/buy_EXP.wav")
const cxk_sound := preload("res://audio/ä½ å¹²å˜›.mp3")

@export var add_pre_click = 100
# åŸºç¡€è®¡æ•°
var total_count := 0
# å‡çº§ç›¸å…³æ ¸å¿ƒæ•°æ®
var player_level := 0          # ç©å®¶å½“å‰ç­‰çº§
var player_EXP := 0            # å½“å‰ç»éªŒå€¼
var exp_cap := 100             # å‡çº§æ‰€éœ€ç»éªŒä¸Šé™ï¼ˆåˆå§‹100ï¼‰
var buy_exp_cost_base := 10    # è´­ä¹°1ç‚¹ç»éªŒçš„åŸºç¡€æ¶ˆè€—ï¼ˆåˆå§‹10ç‚¹æ•°ï¼‰

# å„ç­‰çº§çš„æœ€å¤§å¥–åŠ±å€¼ï¼ˆç´¢å¼•0=ç­‰çº§0ï¼Œç´¢å¼•10=ç­‰çº§10ï¼Œå…±11çº§ï¼‰
var reward_max_values := [
	4, 6, 8, 10, 12, 15, 17, 19, 21, 23, 25  # ç­‰çº§0~10çš„æœ€å¤§å¥–åŠ±å€¼
]
# å„ç­‰çº§çš„åŸºç¡€æ¦‚ç‡æ¨¡æ¿ [+1æ¦‚ç‡, +2æ¦‚ç‡, æœ€å¤§å¥–åŠ±æ¦‚ç‡]ï¼ˆæ€»å’Œ=1ï¼Œç­‰çº§0~10ï¼‰
var level_base_rates := [
	[0.85, 0.10, 0.05],  # ç­‰çº§0
	[0.80, 0.15, 0.05],  # ç­‰çº§1
	[0.75, 0.18, 0.07],  # ç­‰çº§2
	[0.70, 0.20, 0.10],  # ç­‰çº§3
	[0.65, 0.22, 0.13],  # ç­‰çº§4
	[0.60, 0.25, 0.15],  # ç­‰çº§5
	[0.58, 0.26, 0.16],  # ç­‰çº§6
	[0.56, 0.27, 0.17],  # ç­‰çº§7
	[0.54, 0.28, 0.18],  # ç­‰çº§8
	[0.52, 0.29, 0.19],  # ç­‰çº§9
	[0.50, 0.30, 0.20]   # ç­‰çº§10ï¼ˆå°é¡¶ï¼Œ+1æ¦‚ç‡åˆšå¥½è§¦è¾¾50%ä¸‹é™ï¼‰
]

# è·å–å½“å‰è´­ä¹°1ç‚¹ç»éªŒçš„æ¶ˆè€—ç‚¹æ•°ï¼ˆå–æ•´ï¼Œé¿å…å°æ•°ï¼‰
func get_buy_exp_cost() -> int:
	# æ¯å‡1çº§ï¼Œæ¶ˆè€—å¢åŠ 5%ï¼Œå–æ•´
	var cost = buy_exp_cost_base * pow(1.05, player_level)
	return int(round(cost))

# è·å–å½“å‰å‡çº§æ‰€éœ€ç»éªŒä¸Šé™
func get_current_exp_cap() -> int:
	# æ¯å‡1çº§ï¼Œç»éªŒä¸Šé™å¢åŠ 15%ï¼Œå–æ•´
	var cap = exp_cap * pow(1.15, player_level)
	return int(round(cap))

# é‡ç½®ç»éªŒå¹¶æ›´æ–°å‡çº§åçš„é…ç½®
func level_up():
	player_level = min(player_level + 1, len(level_base_rates) - 1)  # ç­‰çº§å°é¡¶10çº§
	player_EXP = 0  # ç»éªŒæ¸…é›¶
	print("ğŸ‰ å‡çº§æˆåŠŸï¼å½“å‰ç­‰çº§ï¼š", player_level, " æœ€å¤§å¥–åŠ±ï¼š+", reward_max_values[player_level])
